http://stackoverflow.com/questions/549/the-definitive-guide-to-form-based-website-authentication#477579
http://stackoverflow.com/questions/244882/what-is-the-best-way-to-implement-remember-me-for-a-website
http://jaspan.com/improved_persistent_login_cookie_best_practice
https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence#title.2

Authentication for the websockets
  https://devcenter.heroku.com/articles/websocket-security
  https://auth0.com/blog/auth-with-socket-io/
  http://howtonode.org/socket-io-auth


The username is used for more than just preferences:
  - trimming sockets
    - for guests, each browser is independent. One browser per guest.
  - auto-reloading clients when the server restarts
    - now, clients will need to reauthenticate if the server restarts

Chat -
  - curently, client sends username with chat message.
  - now, the username/nickname will just be determined based on the socket's session token.


Auth behavior, first pass
  - our room is public
  - t.e. nickname
    - defaults to account name, but you can have a nickname without an account
  - chat is allowed only if you choose a nickname
  - welcome screen (redirect here if try to access room with no nickname or auth)
  - Login should redirect to the room afterward
  - not allowed without auth:
    - DJing
      - Don't show the search bar
      - Don't show the 'click to dj' button
      - (show a message in the queue panel)
    - skip
  - auto log out after... 3 days?
  - remember me
    - what exactly does this do?
    - means that you can close the browser and stay logged in?
  - user can reset password
  - still assign temporary jub-* username for anonymous people
  - don't require logging in every day
    - I guess this means reissuing a token when the expiration gets close

Do next:
  - SERVER
    - don't create new user preferences for jub-* users
      - This breaks UI elements that are backed by this table
        - so just hide those options?
            selectedPlaylist
            requeueVideos
            showChatImages
            allowMuteStatus
            color?
    - separate fetching and initing of playlists
      - why? well, we definitely need to do this for preferences, so that accounts aren't created for every jub-*
    - create in-memory session state of users
      - why? This is what tokens are for
      - expire sessions periodically
    - add reset password feature
      - sends an email to the user with a generated link
        - add /reset_password/:uuid
        - link expires after 1 day
    - add auth check to... pretty much everything but chat and hoot
      - since everything uses sockets, I think this means authenticating socket connections
      - not sure how we'll handle nickname-only users
        - different socket server?
        - give them a token, and make the data different from account users?
          - this is a good solution
          - I think nicknames must then be unique? no, why would that be?
  - UI
    - redirect to /welcome if you know you aren't authed
      - check for session token
      - check expiration
      - make sure socket can connect
    - no more 'username' cookie
    - create 'nickname' cookie
      - mischevious people might delete the cookie, so make sure even read-only interactions
        are gated by nickname || auth
    - create /welcome
      - URL query param 'room'
        - if no query param room, say 'How did you get here?'
      - Two choices:
        - Log in as guest
          - nickname input
          - hidden input for 'room'
          - join button
        - Login --> redirect to /login?room=foo
    - Player UI
      - don't start next video unless nickname or session token
    - chat UI
      - chat socket emissions send auth if present AND nickname
      - don't display chat without nickname || session token
      - on load, make sure default nickname is fetched by client (comes with user prefs)
        - prefer local cookie nickname if it exists
      - if no session token, hide all chat prefs except for 'Nickname' box
    - Queue UI
      - If not logged in, Change 'this playlist is empty' message to 'you must be logged in'
    - top UI
      - hide search bar if no session token
      - Create 'log out' link
        - deletes session token
        - leaves nickname intact
        - redirects to /logout "Goodbye, foo!"
    - Sign up should automatically log you in
    - Add reset password link to login
    - BUG - "room" value gets lost on invalid login/signup


Do later:
  - room admin page
  - independent auth micro-service
  - throttling/limiting for login and reset password
